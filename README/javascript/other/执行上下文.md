### js 的执行上下文？

1. js 执行上下文可以理解为当前代码运行的环境，js 执行上下文分为全局执行上下文，函数执行上下文和 eval 执行上下文。

### 什么情况下会创建执行上下文？

1. 进入全局代码;
2. 进入 function 函数体
3. 进入 eval 函数指向的代码
4. 进入 module 代码

### 全局执行上下文？

1. 全局执行上下文的文本环境有两部分组成，第一部分是全局对象，全局对象指向 window，第二部分是全局 scope。
2. var，function 创建的对象保存在全局对象中，let、const、class 声明的对象保存在全局 scope 中
3. js 代码执行过程中，查找变量的顺序是先查找全局 scope，如果没有再查找全局对象。

```js
// 案例一
function foo() {}
function bar() {
  let a = 1
  foo()
}
console.log(a)
var a = 2
bar()
```

### 执行步骤。

第一步：进入全局代码，创建全局执行上下文，并压入执行栈中。
第二步：收集顶级变量，并进行 foo，bar 以及 a 变量的查重处理（查重规则可参考关键字的规则）。
第三步：创建绑定，初始化处理。
解释：此时全局有三个顶级变量，分别是 foo，bar 以及 a，因为 function 和 var 的变量都是创建在全局对象中的，如图，并且将 var 声明的变量初始化为 undefined， function 声明的变量初始化为函数对象，并且函数初始化时保存了创建时候的文本环境，所以此时 foo 和 bar 都保存了创建时候的全局文本环境。（注意：对于 let，const，class 声明的变量这一步并没有进行初始化）
第四步：执行语句。
解释：将 var 声明的全局变量 a 赋值 2，然后执行 bar 函数，执行 bar 函数同时也会创建 bar 函数执行上下文，并加入执行栈中，bar 函数执行上下文的文本环境中有 let 声明的变量 a，以及 foo 执行函数，此时会继续第二步的操作，进行查重处理。
第五步：此时会将 let 声明的变量 a 登记在函数 scope 中，此处的 a 存在 bar 函数的文本环境中，所以不会影响全局的 a，又由于 a 是 let 声明的，所以此时的 a 并没有进行初始化。(注意：函数的文本环境只有 scope，区别于全局执行上下文有全局对象以及全局 scope)
第六步：执行 foo 函数同时创建 foo 函数执行上下文，并加入执行栈中，只有输出 a，当前的 foo 函数的文本环境中并没有变量 a，所以它会去父级作用域中全寻找，并打印
